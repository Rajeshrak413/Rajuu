<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medika Bazaar | AWB Master Pro</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- jsPDF + autoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root {
            --medika: #004a99;
            --medika-dark: #003366;
            --success: #28a745;
            --danger: #dc3545;
            --locked: #f8f9fa;
            --ready: #fffde7;
        }

        body {
            background: #f5f7fa;
            font-family: system-ui, -apple-system, sans-serif;
        }

        .navbar {
            background: var(--medika);
            border-bottom: 4px solid #e74c3c;
        }

        .card {
            border: none;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.12);
        }

        .scan-input {
            font-size: 2.6rem;
            height: 90px;
            font-weight: 700;
            text-align: center;
            background: var(--locked);
            border: 4px solid #ced4da;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .scan-input:focus {
            border-color: var(--medika);
            box-shadow: 0 0 0 0.35rem rgba(0,74,153,0.22);
            background: white;
        }
        .scan-input::placeholder {
            color: #adb5bd;
            opacity: 1;
        }

        .counter-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 28px 20px;
            box-shadow: 0 10px 30px rgba(102,126,234,0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        .counter-display:hover {
            transform: scale(1.015);
        }
        .counter-number {
            font-size: 7rem;
            font-weight: 900;
            line-height: 1;
            text-shadow: 0 5px 15px rgba(0,0,0,0.45);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .counter-number.pulse {
            animation: pulseNumber 0.7s ease-out;
        }
        @keyframes pulseNumber {
            0%   { transform: scale(1); }
            40%  { transform: scale(1.18); color: #ffd700; }
            100% { transform: scale(1); }
        }

        .stat-value {
            font-size: 2.4rem;
            font-weight: 700;
        }

        .voice-badge {
            position: absolute;
            top: 14px;
            right: 14px;
            font-size: 1rem;
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .voice-badge:hover {
            transform: scale(1.08);
        }

        .keyboard-toggle {
            position: fixed;
            bottom: 28px;
            right: 28px;
            width: 68px;
            height: 68px;
            border-radius: 50%;
            background: var(--medika);
            color: white;
            font-size: 1.9rem;
            border: none;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .keyboard-toggle:hover {
            transform: scale(1.12) translateY(-4px);
            background: var(--medika-dark);
        }
        .keyboard-toggle.disabled {
            background: #6c757d;
        }

        .btn-success, .btn-primary, .btn-info, .btn-dark {
            transition: all 0.25s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.18);
        }

        .flash-success {
            animation: flashGreen 0.6s ease-out;
        }
        @keyframes flashGreen {
            0%   { background: rgba(40,167,69,0); }
            30%  { background: rgba(40,167,69,0.25); }
            100% { background: rgba(40,167,69,0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .modal.fade .modal-dialog {
            transform: scale(0.8);
            transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal.show .modal-dialog {
            transform: scale(1);
        }

        @media print {
            .no-print { display: none !important; }
            #printView { display: block !important; }
        }
    </style>
</head>
<body>

<div id="loaderOverlay">
    <div class="spinner mb-4"></div>
    <h5 class="fw-bold text-primary">Processing...</h5>
</div>

<!-- Print layout -->
<div id="printView" style="display:none; padding:20px;">
    <h2 class="text-center fw-bold mb-4">MANIFEST</h2>
    <div class="d-flex justify-content-between mb-4">
        <h3 id="p-courier" class="fw-bold"></h3>
        <h3 id="p-count" class="border border-dark px-4 py-2 rounded-pill"></h3>
    </div>
    <p class="mb-4">Operator: <b id="p-op"></b> ‚Ä¢ Date: <b id="p-date"></b></p>
    <div id="p-grid" style="display:grid; gap:20px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));"></div>
</div>

<nav class="navbar navbar-dark py-3 no-print">
    <div class="container-fluid">
        <span class="fw-bold fs-4">MEDIKA BAZAAR LOGISTICS</span>
        <button class="btn btn-outline-light btn-sm px-4" onclick="location.reload()">LOGOUT</button>
    </div>
</nav>

<button id="keyboardToggle" class="keyboard-toggle" onclick="toggleKeyboard()" title="Toggle keyboard">‚å®Ô∏è</button>

<div class="container mt-4 no-print">

    <!-- Login -->
    <div id="loginView" class="row justify-content-center mt-5">
        <div class="col-md-5 col-lg-4">
            <div class="card p-5 text-center shadow fade-in">
                <h3 class="mb-4 text-primary fw-bold">Logistics Login</h3>
                <input type="text" id="loginInput" class="form-control form-control-lg text-center mb-4" placeholder="Name or Admin pass" autocomplete="off">
                <button class="btn btn-primary btn-lg w-100 fw-bold" onclick="handleLogin()">ENTER</button>
            </div>
        </div>
    </div>

    <!-- Scanner View -->
    <div id="scannerView" style="display:none;">
        <div class="row g-4">
            <!-- Left ‚Äì Counter & Input -->
            <div class="col-lg-5">
                <div class="counter-display text-center mb-4 fade-in">
                    <div class="counter-number" id="visualCounter">0</div>
                    <div class="counter-label">Parcels Scanned</div>

                    <div class="d-flex justify-content-around mt-4">
                        <div class="text-center">
                            <div class="stat-value" id="scanRate">0</div>
                            <div class="stat-label small">PER MIN</div>
                        </div>
                        <div class="text-center">
                            <div class="stat-value" id="sessionTime">0:00</div>
                            <div class="stat-label small">SESSION</div>
                        </div>
                        <div class="text-center">
                            <div class="stat-value" id="lastScan">--</div>
                            <div class="stat-label small">LAST SCAN</div>
                        </div>
                    </div>
                </div>

                <div class="card p-4 position-relative fade-in">
                    <span class="voice-badge badge bg-success px-3 py-2 fs-6" id="voiceBadge" onclick="toggleVoice()">üîä Voice ON</span>

                    <p class="text-center mb-3 fw-bold">Operator: <span id="displayUser"></span></p>

                    <select id="courierSelect" class="form-select form-select-lg mb-3 fw-bold" onchange="handleCourierChange()">
                        <option value="">-- SELECT COURIER --</option>
                        <option value="ST COURIER">ST COURIER</option>
                        <option value="BLUEDART">BLUEDART</option>
                        <option value="XPRESS BEES">XPRESS BEES</option>
                        <option value="DTDC">DTDC</option>
                        <option value="DELIVERY">DELIVERY</option>
                    </select>

                    <input type="text" id="awbInput" class="scan-input form-control" placeholder="LOCKED" disabled autocomplete="off">

                    <div class="d-grid gap-3 mt-4">
                        <button class="btn btn-success btn-lg fw-bold" onclick="showSyncConfirmation()">COMPLETE & SYNC</button>
                        <div class="btn-group w-100">
                            <button class="btn btn-outline-dark" onclick="triggerPrint()">Print Preview</button>
                            <button class="btn btn-outline-primary" onclick="exportToPDF()">Export PDF</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right ‚Äì List -->
            <div class="col-lg-7">
                <div class="card p-3 fade-in">
                    <h5 class="text-primary mb-3">
                        Scanned Parcels
                        <span id="totalCount" class="badge bg-primary ms-2">0</span>
                    </h5>
                    <div class="table-responsive" style="max-height:520px;">
                        <table class="table table-hover table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>AWB Number</th>
                                    <th style="width:60px;"></th>
                                </tr>
                            </thead>
                            <tbody id="scanBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Sync Confirmation Modal -->
<div class="modal fade" id="syncModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Confirm Sync</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-5">
                <h1 id="confCount" class="display-3 fw-bold mb-3">0</h1>
                <p class="lead mb-0">parcels will be synced & emailed</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success px-5 fw-bold" onclick="doSync()">CONFIRM</button>
            </div>
        </div>
    </div>
</div>

<!-- Audio -->
<audio id="beepOk"    src="https://assets.mixkit.co/sfx/preview/mixkit-confirmation-tone-2869.mp3"></audio>
<audio id="beepError" src="https://assets.mixkit.co/sfx/preview/mixkit-error-tone-2909.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Globals & Elements
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let items = [];
let opName = "";
let voiceEnabled = true;
let keyboardEnabled = true;
let sessionStartTime = null;
let scanTimestamps = [];
let sessionTimer = null;

const today = new Date().toISOString().split('T')[0];

const els = {
    visualCounter: document.getElementById('visualCounter'),
    scanRate:      document.getElementById('scanRate'),
    sessionTime:   document.getElementById('sessionTime'),
    lastScan:      document.getElementById('lastScan'),
    totalCount:    document.getElementById('totalCount'),
    scanBody:      document.getElementById('scanBody'),
    awbInput:      document.getElementById('awbInput'),
    courierSelect: document.getElementById('courierSelect'),
    displayUser:   document.getElementById('displayUser'),
    voiceBadge:    document.getElementById('voiceBadge'),
    keyboardBtn:   document.getElementById('keyboardToggle'),
    confCount:     document.getElementById('confCount')
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Voice & Keyboard
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function speak(text) {
    if (!voiceEnabled) return;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    speechSynthesis.speak(utterance);
}

function toggleVoice() {
    voiceEnabled = !voiceEnabled;
    els.voiceBadge.textContent = voiceEnabled ? 'üîä Voice ON' : 'üîá Voice OFF';
    els.voiceBadge.className = voiceEnabled ? 'voice-badge badge bg-success px-3 py-2 fs-6' : 'voice-badge badge bg-secondary px-3 py-2 fs-6';
    speak(voiceEnabled ? 'Voice enabled' : 'Voice disabled');
}

function toggleKeyboard() {
    keyboardEnabled = !keyboardEnabled;
    els.keyboardBtn.classList.toggle('disabled', !keyboardEnabled);
    els.awbInput.readOnly = !keyboardEnabled;
    if (keyboardEnabled && !els.awbInput.disabled) els.awbInput.focus();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Login & Session
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleLogin() {
    const val = document.getElementById('loginInput').value.trim();
    if (!val) return alert("Enter name or passcode");

    if (val === "0000") {
        document.getElementById('loginView').style.display = 'none';
        document.getElementById('scannerView').style.display = 'none';
        document.getElementById('adminView').style.display = 'block';
        return;
    }

    opName = val;
    els.displayUser.textContent = opName;

    document.getElementById('loginView').style.display = 'none';
    document.getElementById('scannerView').style.display = 'block';

    startSession();
}

function startSession() {
    sessionStartTime = Date.now();
    scanTimestamps = [];
    sessionTimer = setInterval(() => {
        updateSessionTimer();
        updateScanRate();
    }, 1000);
}

function updateSessionTimer() {
    if (!sessionStartTime) return;
    const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
    const m = Math.floor(elapsed / 60);
    const s = elapsed % 60;
    els.sessionTime.textContent = `\( {m}: \){s.toString().padStart(2,'0')}`;
}

function updateScanRate() {
    const now = Date.now();
    scanTimestamps = scanTimestamps.filter(t => now - t < 60000);
    els.scanRate.textContent = scanTimestamps.length;
}

function updateLastScan() {
    const t = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    els.lastScan.textContent = t;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Scanning
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
els.awbInput.addEventListener('change', function() {
    const code = this.value.trim().toUpperCase();
    if (code.length < 6) {
        this.value = '';
        return;
    }

    if (items.includes(code)) {
        document.getElementById('beepError').play().catch(()=>{});
        alert("Duplicate AWB!");
        speak("Duplicate");
        this.value = '';
        return;
    }

    items.push(code);
    scanTimestamps.push(Date.now());

    renderScanList();
    updateVisualCounter(items.length);
    updateScanRate();
    updateLastScan();
    speak(items.length);

    document.getElementById('beepOk').play().catch(()=>{});

    // Visual feedback
    const card = document.querySelector('#scannerView .card');
    card.classList.add('flash-success');
    setTimeout(() => card.classList.remove('flash-success'), 700);

    this.value = '';
    if (keyboardEnabled) this.focus();
});

function renderScanList() {
    els.scanBody.innerHTML = items.map((awb, i) => `
        <tr class="fade-in">
            <td class="fw-bold">${i+1}</td>
            <td class="font-monospace">${awb}</td>
            <td>
                <button class="btn btn-sm btn-outline-danger" onclick="removeAwb(${i})">√ó</button>
            </td>
        </tr>
    `).join('');
    els.totalCount.textContent = items.length;
}

window.removeAwb = function(index) {
    items.splice(index, 1);
    renderScanList();
    updateVisualCounter(items.length);
    updateScanRate();
    speak(items.length);
};

function updateVisualCounter(count) {
    els.visualCounter.textContent = count;
    els.visualCounter.classList.add('pulse');
    setTimeout(() => els.visualCounter.classList.remove('pulse'), 800);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Courier & Sync
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleCourierChange() {
    const ready = els.courierSelect.value !== "";
    els.awbInput.disabled = !ready;
    els.awbInput.placeholder = ready ? "READY ‚Äì Scan AWB" : "LOCKED";
    if (ready && keyboardEnabled) els.awbInput.focus();
}

function showSyncConfirmation() {
    if (items.length === 0) return alert("No parcels scanned.");
    els.confCount.textContent = items.length;
    new bootstrap.Modal(document.getElementById('syncModal')).show();
}

window.doSync = function() {
    bootstrap.Modal.getInstance(document.getElementById('syncModal')).hide();
    document.getElementById('loaderOverlay').style.display = 'flex';

    // Simulate backend call
    setTimeout(() => {
        alert(`Success!\n${items.length} parcels synced & emailed (mock)`);
        document.getElementById('loaderOverlay').style.display = 'none';

        items = [];
        renderScanList();
        updateVisualCounter(0);
        updateScanRate();
        updateLastScan();
    }, 1400);
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// PDF Export
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.exportToPDF = function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ orientation: "landscape", unit: "mm", format: "a4" });

    doc.setFontSize(20);
    doc.text(`MANIFEST ‚Äì ${els.courierSelect.value || 'Unknown'}`, 20, 25);

    doc.setFontSize(12);
    doc.text(`Operator: ${opName}   |   Date: ${today}   |   Total: ${items.length}`, 20, 38);

    doc.autoTable({
        startY: 50,
        head: [['No', 'AWB Number']],
        body: items.map((awb, i) => [i+1, awb]),
        theme: 'grid',
        styles: { fontSize: 10, cellPadding: 4 },
        headStyles: { fillColor: [0,74,153] },
        alternateRowStyles: { fillColor: [245,245,245] },
        columnStyles: { 0: { cellWidth: 25 }, 1: { cellWidth: 'auto' } }
    });

    doc.save(`manifest-${today}.pdf`);
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Print Preview
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.triggerPrint = function() {
    const grid = document.getElementById('p-grid');
    grid.innerHTML = '';

    document.getElementById('p-courier').textContent = els.courierSelect.value || 'Unknown Courier';
    document.getElementById('p-op').textContent = opName;
    document.getElementById('p-date').textContent = today;
    document.getElementById('p-count').textContent = items.length;

    const columns = 2;
    const perColumn = Math.ceil(items.length / columns);

    for (let c = 0; c < columns; c++) {
        const chunk = items.slice(c * perColumn, (c + 1) * perColumn);
        if (!chunk.length) continue;

        let html = '<table class="table table-bordered table-sm"><thead><tr><th>#</th><th>AWB</th></tr></thead><tbody>';
        chunk.forEach((awb, i) => {
            html += `<tr><td>\( {c*perColumn + i + 1}</td><td> \){awb}</td></tr>`;
        });
        html += '</tbody></table>';
        grid.innerHTML += html;
    }

    window.print();
};

// Init
console.log("Medika AWB Master Pro ‚Üí ready");
</script>
</body>
</html>